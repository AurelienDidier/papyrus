<?xml version='1.0' encoding='utf-8' ?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/></head><body><p>Papyrus has already have code generation support for <a href="http://wiki.eclipse.org/Papyrus/Codegen/Cpp_description">C++</a> and  <a href="http://wiki.eclipse.org/Java_Code_Generation">Java</a> programming languages. Besides, support for Ada and C programming languages are also on the way. However, it is possible to develop and integrate new code generators for other programming languages to Papyrus. In this article you will find how add a new code generator to Papyrus from scratch.</p><h2 id="Preparing_the_Development_Environment_.28Prerequisites.29">Preparing the Development Environment (Prerequisites)</h2><p>This section provides a step-by-step guide to set up your development environment in order to be able to add a new code generator for Papyrus.</p><p>Assuming that <a href="https://www.eclipse.org/papyrus/updates/">you have already installed Papyrus</a>, here are the steps you need to follow:</p><ul><li>Install the <b>Qompass (Incubation)</b> modeler extension from <b>Help &gt; Install Papyrus Additional Components</b>.</li></ul><p><img border="0" src="Papyrus_Additional_Components_Discovery.png"/></p><ul><li>Install the <i>Xtend IDE</i>' extension from <b>Help &gt; Install New Software...</b> (select the site <b>Luna - <a href="http://download.eclipse.org/releases/luna">http://download.eclipse.org/releases/luna</a></b>).</li></ul><p><img border="0" src="CodeGen-Xtend-Installation.png"/></p><ul><li>Clone <a href="http://git.eclipse.org/c/papyrus/org.eclipse.papyrus.git">the Eclipse/Papyrus git repository</a> to your local computer.</li></ul><h2 id="Preparing_the_Required_Projects">Preparing the Required Projects</h2><p>To be able to develop a new code generator for a programming language (let's say the <b>X</b> programming language), you need to create three different (but interrelated) projects. </p><ul><li>A main eclipse plug-in project for developing the code generator, which you should name it as <b>org.eclipse.papyrus.<i>x</i>.codegen</b></li><li>An eclipse plug-in project for connecting the code generator to the user interface of Qompass, which you should name it as <b>org.eclipse.papyrus.<i>x</i>.codegen.ui</b></li><li>Another eclipse plug-in project for developing the tests of the code generator, which you should name it as <b>org.eclipse.papyrus.<i>x</i>.codegen.tests</b></li></ul><p>Now, let's create and prepare all these projects one by one.</p><h3 id="The_Main_Code_Generation_Project_for_the_Hypothetical_X_Programming_Language">The Main Code Generation Project for the Hypothetical X Programming Language</h3><p>Here are the steps for creating and setting the <b>org.eclipse.papyrus.x.codegen</b> project:</p><ul><li>Create an eclipse plug-in project. In the <b>Project name</b> box type <b>org.eclipse.papyrus.x.codegen</b> (as shown) and then click <b>Next &gt;</b>.</li></ul><p><img border="0" src="CodeGen-Plugin-Project-Creation.png"/></p><ul><li>In the <b>Version</b> box type the version number of our target Papyrus (in our case to <b>1.0.1.qualifier</b>), in the <b>Name</b> box type <b>%pluginName</b>, in the <b>Vendor</b> box type <b>%providerName</b> and then click <b>Finish</b>.</li></ul><p><img border="0" src="CodeGen-Plugin-Project-Creation-2.png"/></p><ul><li>Upon a successful project creation, you will switch to the <b>Plug-in Development</b> perspective and see an Eclipse workbench window like below.</li></ul><p><img border="0" src="CodeGen-Plugin-Project-Creation-3.png"/></p><ul><li>The project is created. Now, you need to do the required settings for integrating your project to Papyrus. Firstly, add a dependency to the <b>org.eclipse.papyrus.codegen.extensionpoints</b> extension point.</li></ul><p><img border="0" src="CodeGen-Plugin-Project-Creation-4.png"/></p><ul><li>Then add a new language support extension called <b>org.eclipse.papyrus.codegen.extensionpoints.language</b>. </li></ul><p><img border="0" src="CodeGen-Plugin-Project-Creation-5.png"/></p><ul><li>After, create a client for this extension as shown.</li></ul><p><img border="0" src="CodeGen-Plugin-Project-Creation-6.png"/></p><ul><li>And type in this client's <b>language*</b> box <b>X</b>, and in the <b>class</b> box type <b>org.eclipse.papyrus.x.codegen.XLanguageSupport</b>.</li></ul><p><img border="0" src="CodeGen-Plugin-Project-Creation-7.png"/></p><ul><li>Since you do not have such a class yet, you will see a warning like below.</li></ul><p><img border="0" src="CodeGen-Plugin-Project-Creation-8.png"/></p><ul><li>Double click on this warning. go to the warning icon on the opened editor and click <b>Create org.eclipse.papyrus.x.codegen.XLanguageSupport ...</b>.</li></ul><p><img border="0" src="CodeGen-Plugin-Project-Creation-9.png"/></p><ul><li>On the upcoming dialog box, do not change anything and click <b>Finish</b>.</li></ul><p><img border="0" src="CodeGen-Plugin-Project-Creation-10.png"/></p><ul><li>Upon creation, you will see "XLanguageSupport.java" as below. To remove the errors, implement the methods coming from the <b>ILangSupport</b> interface.</li></ul><p><img border="0" src="CodeGen-Plugin-Project-Creation-11.png"/></p><ul><li>However, there will now be other errors due to the new dependencies. </li></ul><p><img border="0" src="CodeGen-Plugin-Project-Creation-12.png"/></p><ul><li>For importing the <b>PackageableElement</b> and <b>Class</b> classes, you need the <b>org.eclipse.uml2.uml</b> plug-in and, for importing the <b>IProject</b> interface, you need the <b>org.eclipse.core.resources</b> plug-in. Add them as dependencies as shown below.</li></ul><p><img border="0" src="CodeGen-Plugin-Project-Creation-13.png"/></p><ul><li>Now, there must be no problem in our project.</li></ul><p><img border="0" src="CodeGen-Plugin-Project-Creation-14.png"/></p><h3 id="The_User_Interface_Project">The User Interface Project</h3><p>Here are the steps for creating and setting the <b>org.eclipse.papyrus.x.codegen.ui</b> project:</p><ul><li>Create an eclipse plug-in project. In the <b>Project name</b> box type <b>org.eclipse.papyrus.x.codegen.ui</b> (as shown) and then click <b>Next &gt;</b>.</li></ul><p><img border="0" src="CodeGen-Plugin-Project-UI-Creation.png"/></p><ul><li>In the <b>Version</b> box type the version number of our target Papyrus (in your case to <b>1.0.1.qualifier</b>), in the <b>Name</b> box type <b>%pluginName</b>, in the <b>Vendor</b> box type <b>%providerName</b> and then click <b>Finish</b>.</li></ul><p><img border="0" src="CodeGen-Plugin-Project-UI-Creation-2.png"/></p><ul><li>Upon a successful project creation, you will switch to the <b>Plug-in Development</b> perspective and see a window like below.</li></ul><p><img border="0" src="CodeGen-Plugin-Project-UI-Creation-3.png"/></p><ul><li>The project is created. Now, you need to do the required settings for integrating this user interface project to the main code generation project. Firstly, add a dependency to the <b>org.eclipse.papyrus.x.codegen</b> plug-in, in which you prepared in the previous step.</li></ul><p><img border="0" src="CodeGen-Plugin-Project-UI-Creation-4.png"/></p><ul><li>Now you need to add some extensions for organizing your menus. Firstly, add <b>org.eclipse.ui.menus</b>.</li></ul><p><img border="0" src="CodeGen-Plugin-Project-UI-Creation-5.png"/></p><ul><li>However, upon this addition, you may see a <b>No schema found for the 'org.eclipse.ui.menus' extension point</b> warning message as shown.</li></ul><p><img border="0" src="CodeGen-Plugin-Project-UI-Creation-6.png"/></p><ul><li>In this case,install <b>Eclipse RCP Target Components</b> to your eclipse from <b>The Eclipse Project Updates</b> software site.</li></ul><p><img border="0" src="CodeGen-Plugin-Project-UI-Creation-7.png"/></p><ul><li>After following the installation instructions and restarting your eclipse, things will be fine.</li></ul><p><img border="0" src="CodeGen-Plugin-Project-UI-Creation-8.png"/></p><ul><li>Now add a menu contribution to the extension you added and...</li></ul><p><img border="0" src="CodeGen-Plugin-Project-UI-Creation-9.png"/></p><ul><li>...in the <b>locationURI</b> box type <b>popup:org.eclipse.papyrus.views.modelexplorer.popup.codegen</b>.</li></ul><p><img border="0" src="CodeGen-Plugin-Project-UI-Creation-10.png"/></p><ul><li>Then create a command for this menu contribution and...</li></ul><p><img border="0" src="CodeGen-Plugin-Project-UI-Creation-11.png"/></p><ul><li>...in the <b>commandID</b> box type <b>org.eclipse.papyrus.x.codegen.command</b>, in the <b>label</b> and <b>tooltip</b> boxes type <b>Generate X code</b>.</li></ul><p><img border="0" src="CodeGen-Plugin-Project-UI-Creation-12.png"/></p><ul><li>The second extension you need to add is <b>org.eclipse.ui.commands</b> and you need to create a command for it also, which has the following the properties: in the <b>id</b> box type <b>org.eclipse.papyrus.x.codegen.command</b>, in the <b>name</b> and <b>description</b> bozes type <b>Generate X Code</b>, in the <b>categoryId</b> box type <b>org.eclipse.papyrus.editor.category</b> and in the <b>defaultHandler</b> box type <b>org.eclipse.papyrus.x.codegen.ui.handlers.GenerateCodeHandler</b>.</li></ul><p><img border="0" src="CodeGen-Plugin-Project-UI-Creation-13.png"/></p><ul><li>Careful readers has already noticed that there is a warning occuring after this step (see the <b>Problems</b> tab on the above figure). The reason for this warning is that you defined a default handler that does not exist yet. To go to source of the problem, double-click to the warning and create a new handler class (keep default properties in the create class dialog window).</li></ul><p><img border="0" src="CodeGen-Plugin-Project-UI-Creation-14.png"/></p><ul><li>The created handler class should extend the <b>CmdHandler</b> class which is located in the <b>org.eclipse.papyrus.uml.diagram.common</b> plug-in. Thus, add this plug-in to the dependencies and then implement the unimplemented methods. To see how this handler is executed, add a system verbose inside its <b>execute()</b> method.</li></ul><p><img border="0" src="CodeGen-Plugin-Project-UI-Creation-14-2.png"/></p><ul><li>The last extension you need to add is <b>org.eclipse.ui.preferencePages</b>. Upon its creation, it comes with a default page. Modify the properties of this page as follows: in the <b>id</b> box type <b>org.eclipse.papyrus.x.codegen.ui.preferences.CodeGenPreferencePage</b>, in the <b>name</b> box type <b>X code generation</b>, in the <b>class</b> box type <b>org.eclipse.papyrus.x.codegen.ui.preferences.CodegenPreferencePage</b> and in the <b>category</b> box type <b>org.eclipse.papyrus.infra.core.sasheditor.preferences.generalcategory</b>.</li></ul><p><img border="0" src="CodeGen-Plugin-Project-UI-Creation-15.png"/></p><ul><li>However, like before, there is a warning occuring after this step (see the <b>Problems</b> tab on the above figure). The reason for this warning is that you defined a <b>preference page</b> that does not exist yet. To go to source of the problem, double-click to this warning and creat a new preference page class (keep default properties in the create class dialog window).</li></ul><p><img border="0" src="CodeGen-Plugin-Project-UI-Creation-15-2.png"/></p><ul><li>The created preference page class should extend the <b>PreferencePage</b> class and implement the <b>IWorkbenchPreferencePage</b> interface. Normally, no modification is needed after the creation of the preference page class.</li></ul><p><img border="0" src="CodeGen-Plugin-Project-UI-Creation-15-3.png"/></p><ul><li>Now let's try what you have done so far and see your code generation menu on a real case. In this sense, to create an <b>Eclipse Application</b> run configuration click <b>Run &gt; Run Configurations...</b> and in the <b>VM arguments</b> box type: <b>-Dosgi.requiredJavaVersion=1.6 -Xms40m -Xmx512m -XX:MaxPermSize=1024m</b>.</li></ul><p><img border="0" src="CodeGen-Plugin-Project-UI-Creation-16.png"/></p><ul><li>Then click <b>Run</b> to run our eclipse application. In the new eclipse instance, click <b>File &gt; New &gt; Example...</b>, click <b>C/C++ hello world example</b> under the <b>Papyrus examples</b> folder and click <b>Next &gt;</b>.</li></ul><p><img border="0" src="CodeGen-Plugin-Project-UI-Creation-17.png"/></p><ul><li>After, select a parent folder for your example and click <b>Finish</b>. In this example, there is a <b>CodeGenerationExamples</b> java project that was created in advance. </li></ul><p><img border="0" src="CodeGen-Plugin-Project-UI-Creation-18.png"/></p><ul><li>The example project will be created and the <b>HelloWorldOO.di</b> Papyrus model will be opened directly. There is only one class diagram which is called <b>HelloWorld</b> in this model. Now, right click on the <b>HelloWorld</b> class and go to <b>Code Generation</b>. You need to see <b>Generate X code</b> there, click it! (Curious readers may click <b>Generate C++ code</b> and see how Qompass generates C++ codes.)</li></ul><p><img border="0" src="CodeGen-Plugin-Project-UI-Creation-19.png"/></p><ul><li>Clicking the <b>Generate X code</b> pop-up menu will cause the handler to execute and thus you need to see the system verbose you defined the handler class on the console of the main workbench.</li></ul><p><img border="0" src="CodeGen-Plugin-Project-UI-Creation-20.png"/></p><p>If all the steps worked fine, you can go on by creating the test project of your code generator.</p><h3 id="The_Test_Project">The Test Project</h3><p>Here are the steps for creating and setting the "org.eclipse.papyrus.x.codegen.tests" project:</p><h2 id="Developing_the_New_Code_Generator">Developing the New Code Generator</h2><p>To develop a new code generator, you will use <a href="https://www.eclipse.org/xtend/">the Xtend language</a>. For starting Xtend, see <a href="https://www.youtube.com/watch?v=EzH5MPd13iI">the Xtend introductory video</a> and <a href="https://www.eclipse.org/xtend/documentation.html">the Xtend documentation</a>.</p><h3 id="Basic_Configuration">Basic Configuration</h3><p>Here are the basic configuration steps for developing the example code generator:</p><ul><li>Add the <b>org.eclipse.uml2.uml</b> and <b>org.eclipse.core.resources</b> plug-ins as dependencies to the <b>org.eclipse.papyrus.x.codegen.ui</b> project.</li></ul><p><img border="0" src="CodeGen-Xtend-00-01.png"/></p><ul><li>Change the <b>execute()</b> method of  the <b>GenerateCodeHandler</b> class as follows.</li></ul><p><img border="0" src="CodeGen-Xtend-00-02.png"/></p><ul><li>Create a <b>getCurentProject()</b> method in the same class.</li></ul><p><img border="0" src="CodeGen-Xtend-00-03.png"/></p><ul><li>Create a new java class named <b>XModelElementsCreator</b>.</li></ul><p><img border="0" src="CodeGen-Xtend-00-04.png"/></p><ul><li>In the <b>Source folder</b> box type <b>org.eclipse.papyrus.x.codegen/src</b>, in the <b>Package</b> box type <b>org.eclipse.papyrus.x.codegen.transformations</b> and in the <b>Superclass</b> box type <b>org.eclipse.papyrus.codegen.base.ModelElementsCreator</b>. Then click <b>Finish</b>.</li></ul><p><img border="0" src="CodeGen-Xtend-00-05.png"/></p><ul><li>Upon creation, you will have an error about having no contructor methods in <b>XModelElementsCreator</b>. Add a public constructor as shown.</li></ul><p><img border="0" src="CodeGen-Xtend-00-06.png"/></p><ul><li>Go back to <b>GenerateCodeHandler</b> and organize imports (Ctrl+Shift+O). You will encounter an access restriction problem. To resolve it, export the <b>org.eclipse.papyrus.x.codegen.transformations</b> package from the <b>org.eclipse.papyrus.x.codegen</b> plug-in as shown.</li></ul><p><img border="0" src="CodeGen-Xtend-00-07.png"/></p><ul><li>Add the <b>org.eclipse.papyrus.codegen.base</b> plug-in as a dependency to the <b>org.eclipse.papyrus.x.codegen.ui</b> project and then add a <b>generate()</b> method to the <b>GenerateCodeHandler</b> class as shown.</li></ul><p><img border="0" src="CodeGen-Xtend-00-08.png"/></p><ul><li>Change the <b>createPackageableElementFile()</b> method of <b>XModelElementsCreator</b> and add the <b>generatePackage()</b> method used by this method.</li></ul><p><img border="0" src="CodeGen-Xtend-00-09.png"/></p><ul><li>Create a new <b>org.eclipse.papyrus.x.codegen.xtend</b> package inside the <b>org.eclipse.papyrus.x.codegen</b> project from <b>File &gt; New &gt; Package</b> and click <b>Finish</b>.</li></ul><p><img border="0" src="CodeGen-Xtend-00-10.png"/></p><ul><li>Create a new <b>Xtend class</b> inside this package from <b>File &gt; New &gt; Other...</b> .</li></ul><p><img border="0" src="CodeGen-Xtend-00-11.png"/></p><ul><li>In the <b>Name</b> box type <b>XPackageHeaderGenerator</b> and click <b>Finish</b>.</li></ul><p><img border="0" src="CodeGen-Xtend-00-12.png"/></p><ul><li>Go back to <b>XModelElementsCreator</b> and organize imports (Ctrl+Shift+O). Then come back to <b>XPackageHeaderGenerator</b> and add a <b>generateCode()</b> method as shown.</li></ul><p><img border="0" src="CodeGen-Xtend-00-13.png"/></p><ul><li>Override the <b>isEnabled()</b> method in <b>GenerateCodeHandler</b> as below. </li></ul><p><img border="0" src="CodeGen-Xtend-00-14.png"/></p><ul><li>Now let's try what you have done so far and see how your code generation works. Run the Eclipse workbench from <b>Run &gt; Run History &gt; Eclipse Application</b>.</li></ul><p><img border="0" src="CodeGen-Xtend-00-15.png"/></p><ul><li>Right click on the <b>HelloWorld</b> package and choose <b>Code generation &gt; Generate X code</b>.</li></ul><p><img border="0" src="CodeGen-Xtend-00-16.png"/></p><ul><li>X code for the <b>HelloWorld</b> package is created in the <b>HelloWorld.xx</b> file. Double click on it from the <b>Package Explorer</b> and see the resulting generation.</li></ul><p><img border="0" src="CodeGen-Xtend-00-17.png"/></p><h3 id="Advanced_Options">Advanced Options</h3><h4 id="Generating_the_Code_in_a_New_Project">Generating the Code in a New Project</h4><h4 id="Dealing_with_Errors">Dealing with Errors</h4><h2 id="Integrating_the_New_Code_Generator_to_Papyrus.2FQompass">Integrating the New Code Generator to Papyrus/Qompass</h2><p>The ultimate goal of developing a new code generator is to make it available to all users. If you want to integrate your new code generator into Papyrus/Qompass, just contact with us.</p></body></html>