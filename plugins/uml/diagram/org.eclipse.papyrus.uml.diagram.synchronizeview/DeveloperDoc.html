<html><link rel="stylesheet" href="default.css" type="text/css"><H1>Synchronize automatically between views element with related model element in the model</H1><P>The goal is to enable a strong synchronization between visual elements displayed in the diagram with elements contained in the model. <BR/>This mechanism can be added locally for each element by using CSS. <BR/>For example, you would like to see: <BR/>- synchronize compartment of enumeration literal for all enumeration. <BR/>- synchronize compartment of attributes and operation for all class stereotyped ….<BR/>This fucntionality is associated to the task 433206.<BR/></P><H2>Requirements</H2><P>- LocalSynchronization (id=Req001): <BR/> The synchronization shall be local for each graphical element for example: package compartment, attribute compartment...</P><P>- CSSIntegration (id=Req002): <BR/> The synchronization shall be  parameterized by CSS, by using a keyword and a value.</P><P>- CustomSynchronization (id=Req003): <BR/> For an graphical element, it shall be possible to custom the synchonization</P><H2>Use Cases</H2><P align="middle"><img src=C:/git/org.eclipse.papyrus/plugins/uml/diagram/org.eclipse.papyrus.uml.diagram.synchronizeview/imgDOC/UseCaseDiagram.png alt=UseCaseDiagram ></P><P align="middle">UseCaseDiagram</P><H3>Add an element in the model</H3><P>When an user adds an element in the model, the synchronization mechanism try to add in the current diagram the view that correspond to the semantic element<BR/>The difficulty of this mechanism is to parameter the synchronization.<BR/>By default, the synchronizatiopn is based on ' owned element'role. When you add an element, the  graphical element that correponds to the owner try to display it in the diagram. <BR/>But some cases are not interesting. For example in the composite diagram, displaying parts in part correspond to part of the type, not directly part of part.</P><H3>Move an element</H3><P>When a element is moved, the synchronization mechanism must to create graphically the element to each diagram.<BR/></P><H3>Set synchronization enable</H3><P>The user can set enable  the synchronization for a set of graphical elements.<BR/></P><H3>Remove an element from the model</H3><P>When the element is removed,  the corresponding graphical element must be removed.</P><H2>Design</H2><P align="middle"><img src=C:/git/org.eclipse.papyrus/plugins/uml/diagram/org.eclipse.papyrus.uml.diagram.synchronizeview/imgDOC/ArchitectureOverview.png alt=ArchitectureOverview ></P><P align="middle">ArchitectureOverview</P><P>The desing consists into one plugin org.eclipse.papyrus.uml.diagram.synchronizeview.<BR/>I contains a editpolicy provider and an extension point</P><P align="middle"><img src=C:/git/org.eclipse.papyrus/plugins/uml/diagram/org.eclipse.papyrus.uml.diagram.synchronizeview/imgDOC/Structure.png alt=Structure ></P><P align="middle">Structure</P><P>The edit policy SynchronizeViewEdipolicty is installed by the SynchronizeEditPolicyProvider on:<BR/>	- DiagramEditPart (to synchronize content of diagram)<BR/>	- CompartmentEditPart  (to synchronize content of compartment)<BR/>	- IBorderedShapeEditPart  (to synchronize content of borderedElement as port....)<BR/><BR/>ThisEditPolicy is used to allowing synchronization between graphical element and element in the model<BR/>  It is based on canonical editpolicy but it has several differencies:<BR/>  - View Service cannot be called. To call it we need to get the identifier of the child that could be place in compartment. I is not possible to find in a generic way<BR/>  --> link to each Diagram Updater, and moreover some child has been created by custom code. In fact, the hierarchy of visual element must follow the hierachy of semantic element.<BR/>  --> this is not the case so the Diagram updater generated from the gmfgen has not the good info.<BR/><BR/>So to an extension point has been added to let the developer to specify semantic element that play children of a given editpart:<BR/> see the example:<BR/><extension<BR/>      point="org.eclipse.papyrus.uml.diagram.synchronizeview.semanticchild"><BR/>   <semanticChild<BR/>         editPart="org.eclipse.papyrus.uml.diagram.composite.edit.parts.PropertyPartCompartmentEditPartCN"<BR/>         getSemanticChildren="org.eclipse.papyrus.uml.diagram.composite.SynchroSemanticForPopertyPartCompartment"><BR/>   </semanticChild><BR/></extension<BR/><BR/>The editpolicy try to refresh visual element. To do that it calls the method  getSemanticChildrenList(). I llokf for accoss the extesnison point the corresponding 'SemantiChild' with the highest priority.<BR/>This object give the list of sementic element that could be children of the context of the given editpart.<BR/><BR/>In the context of part, in the composite diagram, we can describe that children are ownedlement of the type of the part.<BR/><BR/>Finally to allow the creation we base our work on the mechanism of the drop. (refreshSemanticChildrenByDrop)</P><P>In order to install synchronization on element, views must have canonical style. So a migration is needed.<BR/>BasicCompartment becomes Compartment<BR/>Diagram and Shape mst have a style: so we need to add :<BR/>	CanonicalStyle canonicalStyle=(CanonicalStyle)diagram.createStyle(NotationPackage.eINSTANCE.getCanonicalStyle());<BR/>	canonicalStyle.setCanonical(false);</P></html>